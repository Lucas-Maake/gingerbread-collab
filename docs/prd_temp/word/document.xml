<?xml version="1.0" encoding="UTF-8" standalone="yes"?><w:document mc:Ignorable="w14 w15 wp14" xmlns:wpc="http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:wp14="http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing" xmlns:wp="http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing" xmlns:w10="urn:schemas-microsoft-com:office:word" xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main" xmlns:w14="http://schemas.microsoft.com/office/word/2010/wordml" xmlns:w15="http://schemas.microsoft.com/office/word/2012/wordml" xmlns:wpg="http://schemas.microsoft.com/office/word/2010/wordprocessingGroup" xmlns:wpi="http://schemas.microsoft.com/office/word/2010/wordprocessingInk" xmlns:wne="http://schemas.microsoft.com/office/word/2006/wordml" xmlns:wps="http://schemas.microsoft.com/office/word/2010/wordprocessingShape" xmlns:cx="http://schemas.microsoft.com/office/drawing/2014/chartex" xmlns:cx1="http://schemas.microsoft.com/office/drawing/2015/9/8/chartex" xmlns:cx2="http://schemas.microsoft.com/office/drawing/2015/10/21/chartex" xmlns:cx3="http://schemas.microsoft.com/office/drawing/2016/5/9/chartex" xmlns:cx4="http://schemas.microsoft.com/office/drawing/2016/5/10/chartex" xmlns:cx5="http://schemas.microsoft.com/office/drawing/2016/5/11/chartex" xmlns:cx6="http://schemas.microsoft.com/office/drawing/2016/5/12/chartex" xmlns:cx7="http://schemas.microsoft.com/office/drawing/2016/5/13/chartex" xmlns:cx8="http://schemas.microsoft.com/office/drawing/2016/5/14/chartex" xmlns:aink="http://schemas.microsoft.com/office/drawing/2016/ink" xmlns:am3d="http://schemas.microsoft.com/office/drawing/2017/model3d" xmlns:w16cex="http://schemas.microsoft.com/office/word/2018/wordml/cex" xmlns:w16cid="http://schemas.microsoft.com/office/word/2016/wordml/cid" xmlns:w16="http://schemas.microsoft.com/office/word/2018/wordml" xmlns:w16sdtdh="http://schemas.microsoft.com/office/word/2020/wordml/sdtdatahash" xmlns:w16se="http://schemas.microsoft.com/office/word/2015/wordml/symex"><w:body><w:p><w:pPr><w:pStyle w:val="Title"/><w:spacing w:after="400"/><w:jc w:val="center"/></w:pPr><w:r><w:t xml:space="preserve">Gingerbread Collab Builder — MVP PRD (v2)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Product Summary</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">A web-based, 3D collaborative gingerbread house builder. Users join a shared room ID (up to 6 people), see each other&apos;s cursors, and place/arrange pieces together in real time. The vibe is LoFi + Christmas cozy.</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Goals (MVP)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">1. Join/create a room via URL; max 6 concurrent users.</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">2. Shared 3D build surface with a small set of pieces.</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">3. Real-time presence + cursors.</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">4. Real-time piece manipulation with server-authoritative locking to prevent two users grabbing the same piece.</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">5. Rate-limited updates (cursor + transforms) so rooms don&apos;t melt down.</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">6. Simple placement validation so two pieces can&apos;t &quot;finalize&quot; into the exact same grid cell simultaneously.</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">7. Cozy LoFi Christmas UI polish (lightweight).</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Non-Goals (Explicitly Out of MVP)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Physics stacking, rigidbody simulation</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Advanced collision meshes</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Accounts/login</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Persistent builds stored for days</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Complex snapping constraints between arbitrary faces</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Mobile/tablet support</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Anti-troll mechanisms (deferred to post-MVP)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Success Metrics</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">User Engagement Metrics</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Average session duration: 10+ minutes</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Completion rate: 60%+ of rooms place at least 10 pieces</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Multi-user engagement: 70%+ of rooms have 2+ concurrent users at some point</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Repeat usage: 30%+ of users create or join a second room within the same session</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Technical Performance Metrics</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Client-to-server latency: &lt; 100ms (P95)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Transform update propagation: &lt; 50ms to all clients (P95)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Client FPS: 60 FPS maintained with 6 users and 50 pieces (P90)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Initial load time: &lt; 3 seconds for room join</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Server capacity: Support 100 concurrent rooms (600 users) on a single instance</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Reliability Metrics</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Zero critical bugs in production</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Server uptime: 99.5%+</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Successful reconnection rate: 95%+ within 5 seconds of disconnect</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Lock conflict resolution: &lt; 1% of grab attempts result in lock conflicts</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Target Users</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Small friend groups (2–6) who want a quick, delightful collaborative toy</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Desktop users only (MVP constraint)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• No onboarding required; &quot;click link, build together&quot;</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Technical Stack</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Frontend</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Framework: React 18+</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• 3D Engine: Three.js (r150+)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• State Management: React Context + useReducer</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Build Tool: Vite</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Backend</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Runtime: Node.js 18+</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• WebSocket: Socket.io (v4+)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Server Type: Persistent server (not serverless)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• In-memory state: No database for MVP (rooms live only while server runs)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Deployment</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Hosting: TBD (AWS/GCP/Render/Railway)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• CDN: Cloudflare or similar for static assets</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">UX Flows</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Landing Page</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• &quot;Create Room&quot; button → generates short room code (6 chars) and navigates to /room/XXXXXX</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• &quot;Join Room&quot; input → navigates to /room/&lt;code&gt;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Optional: Nickname input (stored in localStorage)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Room Page</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• 3D canvas (build table/plate) — isometric view, fixed camera angle</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Piece tray/palette (bottom of screen) — click to spawn unlimited pieces</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Presence bar (top right) — user avatars/colors showing who&apos;s connected</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Cursor visualization — 3D cursor raycast onto build surface showing other users&apos; pointers</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Controls overlay (bottom left) — keyboard shortcuts and interaction hints</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Undo button (top left) — reverts last action for that user only</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Camera Controls</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Camera Type</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Orthographic camera with fixed isometric angle (45° above table)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• No free orbit for MVP — simplifies UX and maintains shared perspective</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">User Controls</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Pan: Middle mouse drag or Shift + Left mouse drag</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Zoom: Mouse scroll wheel (constrained between 5–20 world units)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• No rotation: Camera angle is locked</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Constraints</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Camera cannot go below table surface (Y position locked above 0)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Pan bounds: Camera center stays within 2 world units of build surface edges</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Zoom limits: Min 5 units (close), Max 20 units (far overview)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">World &amp; Interaction Spec</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Build Surface</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• A rectangular table plane with bounds (width 10, depth 10 in world units)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Pieces must remain within bounds (validated server-side on release)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Pieces (MVP Set)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Base platform (1 type, unlimited spawns)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Walls (4 types for different orientations, unlimited spawns)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Roof halves (2 types, unlimited spawns)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Door (1 type, unlimited spawns)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Windows (2 types, unlimited spawns)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Candy/sprinkles (10–20 simple prop types, unlimited spawns)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Total piece cap per room: 50 pieces maximum (server-enforced)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:rPr><w:b/><w:bCs/></w:rPr><w:t xml:space="preserve">Note: </w:t></w:r><w:r><w:t xml:space="preserve">MVP assets can be primitives (boxes/planes) with gingerbread-like colors; swap to 3D models post-MVP.</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Piece Spawning</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Users click piece type in tray to spawn a new instance</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Piece spawns at center of build surface with random Y rotation</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• If room has reached 50-piece cap, spawn button is disabled with tooltip: &quot;Room full (50 pieces max)&quot;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Spawned piece is immediately grabbed by the user who spawned it</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Manipulation Rules</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Click piece to attempt grab (server lock request)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Drag to move on XZ plane (Y fixed to surface, no vertical movement)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Rotate around Y axis (yaw) only — Q/E keys or mouse wheel while grabbed</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• While grabbed, piece shows &quot;Held by &lt;name&gt;&quot; outline/tint for others</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Right-click on own piece to delete it (spawner only can delete)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Release: Click again or press Escape to finalize placement</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Undo Functionality</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Each user has a personal undo stack (last 10 actions)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Undoable actions: piece placement (move + rotation), piece spawn, piece delete</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Undo button in top-left corner or Ctrl+Z hotkey</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Server validates undo requests (only allow undo of own actions)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">UI/UX Polish</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Visual Theme</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Color palette: Warm browns, creams, reds, and greens (gingerbread + Christmas)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Background: Soft gradient (dark blue to purple) with subtle vignette</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Lighting: Warm point light from above (simulating kitchen overhead light)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Table surface: Wood texture (placeholder or simple procedural)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Particle Effects</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Light snow particles falling gently across the scene</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Particles do not interact with pieces (visual only, no physics)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• ~50-100 particles at any time for performance</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Audio</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Background music: Lofi Christmas instrumental (royalty-free)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Music loops seamlessly, volume set to 30% by default</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Mute button in top-right corner for users who prefer silence</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• No sound effects for MVP (defer to post-MVP)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">User Presence Indicators</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Each user assigned a distinct color from palette: [Red, Blue, Green, Yellow, Purple, Orange]</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• 3D cursor shows as colored sphere at raycast position for each user</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Username label floats above cursor (billboard sprite, always faces camera)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Grabbed pieces show colored outline matching user&apos;s color</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Error Handling &amp; User Feedback</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Room Full (ROOM_FULL)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Trigger: User tries to join a room with 6 active connections</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• UI: Modal popup with message: &quot;This room is full (6/6 users). Try creating your own room!&quot;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Action: Redirect to landing page with &quot;Create Room&quot; button highlighted</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Piece Grab Denied (LOCK_DENIED)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Trigger: User clicks piece already held by another user</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• UI: Immediate visual feedback (&lt; 50ms):</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - Piece flashes red outline briefly (200ms pulse)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - Small tooltip appears: &quot;Held by &lt;username&gt;&quot;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Behavior: Piece does not move for the denied user; remains in place</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Piece Cap Reached</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Trigger: Room has 50 pieces; user tries to spawn another</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• UI: Spawn buttons grayed out with tooltip: &quot;Room piece limit reached (50 max)&quot;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Note: Deleting a piece frees up a slot immediately</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Network Disconnection</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Trigger: WebSocket connection drops</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• UI: Semi-transparent overlay with message: &quot;Connection lost. Reconnecting...&quot;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Behavior: Client attempts reconnect every 2 seconds (max 5 attempts)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• On successful reconnect: Overlay fades, client requests full snapshot</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• On failure: Overlay shows &quot;Unable to reconnect. Refresh page to try again.&quot;</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Placement Rejection (Occupancy Conflict)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Trigger: User releases piece, but target grid cell is occupied</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• UI Strategy: Nudge to nearest free cell (chosen for MVP)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - Server finds nearest unoccupied cell within 1 world unit radius</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - Piece smoothly lerps to corrected position (300ms animation)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - Small tooltip appears briefly: &quot;Adjusted to avoid collision&quot;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Fallback: If no free cell within radius, reject entirely and snap piece back to last valid position</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Invalid Room Code</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Trigger: User navigates to /room/INVALID or room doesn&apos;t exist</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• UI: Centered modal: &quot;Room not found. Would you like to create a new room?&quot;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Actions: [Create New Room] [Back to Home]</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Realtime Architecture (MVP)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Core Decision</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:rPr><w:b/><w:bCs/></w:rPr><w:t xml:space="preserve">Server-authoritative room state with hard locks on pieces.</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Clients request to grab a piece</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Server grants lock to first requester; denies others with immediate feedback</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Client streams transforms only for pieces it holds</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Server validates and broadcasts accepted transforms</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• On join/reconnect, server sends full snapshot</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">This avoids CRDT complexity and prevents &quot;two people moving same piece&quot; conflicts.</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Room Capacity</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Server enforces max 6 users</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Additional connections rejected with ROOM_FULL message</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Identity Management</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Each connection gets a userId assigned by server on join</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Client can present userId from sessionStorage for reconnection</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Server assigns color from fixed palette: [Red, Blue, Green, Yellow, Purple, Orange]</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Nickname optional; if absent, server uses &quot;Guest ####&quot; (random 4 digits)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Data Model</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">RoomState</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• roomId: string</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• users: Map&lt;userId, UserState&gt;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• pieces: Map&lt;pieceId, PieceState&gt;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• occupancy: Map&lt;cellKey, pieceId&gt; (for final placement collision at RELEASE)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• createdAt: number (timestamp for cleanup)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• lastActivityAt: number (timestamp for idle room detection)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">UserState</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• userId: string</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• name: string</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• color: string (hex code)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• cursor: { x: number, y: number, z: number, t: number } (3D world raycast position)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• lastSeenAt: number (timestamp for disconnect detection)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• isActive: boolean (for AFK detection, set false if no activity for 5 minutes)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">PieceState</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• pieceId: string (UUID)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• type: string (WALL, ROOF, CANDY, etc.)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• pos: [number, number, number] (XYZ position)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• yaw: number (rotation in radians, Y-axis only)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• heldBy: userId | null (lock holder)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• spawnedBy: userId (for delete permission)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• version: number (monotonic; server is source of truth for optimistic updates)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• updatedAt: number (timestamp)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Occupancy Grid (MVP Collision Prevention)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Grid Quantization</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Quantize XZ plane into grid cells, cellSize = 0.25 world units</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Compute cellKey = `${Math.floor(x/0.25)}:${Math.floor(z/0.25)}`</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Release Validation</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">On piece RELEASE, server checks:</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">1. If target cellKey is free → accept and set occupancy[cellKey] = pieceId</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">2. If occupied → nudge to nearest free cell within 1 world unit radius</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">3. If no free cell within radius → reject release; snap piece back to last valid position</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:rPr><w:b/><w:bCs/></w:rPr><w:t xml:space="preserve">This prevents &quot;two pieces placed in same spot at same time&quot; because RELEASE is atomic server-side.</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Rate Limiting &amp; Update Reduction (MVP)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Client-Side Caps</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Cursor updates: max 15 Hz (66ms intervals)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Transform updates while dragging: max 20 Hz (50ms intervals)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Deadband filter: do not send update if movement &lt; 0.005 units AND yaw change &lt; 0.5°</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Server-Side Caps</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">Per-connection token bucket:</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Cursor updates: 20 tokens/sec, burst capacity 10</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Transform updates: 30 tokens/sec, burst capacity 15</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Server may broadcast at most 20 Hz per piece (drop intermediate updates if needed)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Reconnection &amp; Lock Cleanup</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">User Disconnect</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Mark user as gone immediately (remove from presence)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Release any locks held by that user after 2-second grace period (prevents &quot;ghost locks&quot;)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Pieces remain in place; lock simply becomes available to others</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">User Reconnect</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Client requests snapshot, optionally presents previous userId from sessionStorage</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• If server recognizes userId and it was disconnected &lt; 30 seconds ago → reuse identity</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Otherwise → treat as new user, assign fresh userId and color</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Server sends full RoomState snapshot</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Rapid Reconnection Protection</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• If same IP reconnects &gt; 5 times in 10 seconds → temporary 30-second cooldown</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Prevents connection flapping from spamming room</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Room Lifecycle &amp; Cleanup</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Room Creation</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Room created when first user joins a non-existent roomId</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Room code: 6 alphanumeric characters (uppercase, no ambiguous chars: 0/O, 1/I/L)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• RoomState initialized with empty users and pieces maps</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Room Destruction (MVP - No Persistence)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">Rooms are destroyed immediately under these conditions:</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• All users disconnect → room deleted after 60 seconds of being empty</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Server restart → all rooms lost (no persistence layer in MVP)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:rPr><w:b/><w:bCs/></w:rPr><w:t xml:space="preserve">Important: </w:t></w:r><w:r><w:t xml:space="preserve">Users should be warned that rooms are ephemeral. Consider adding tooltip: &quot;Rooms last only while users are connected. No save feature in MVP.&quot;</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Idle Room Cleanup</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Rooms with no activity (no piece moves, spawns, or deletes) for 30 minutes → marked as idle</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Idle rooms still with connected users get a warning banner: &quot;No activity for 30 min. Room will close in 5 minutes.&quot;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• If no activity within warning period → disconnect all users and delete room</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Edge Cases &amp; Implementation Notes</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Simultaneous Grab Attempts</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Two users click same piece within network latency window (&lt; 50ms)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Server processes requests in order received (first to reach server wins)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Losing user receives LOCK_DENIED immediately upon server processing their request</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Client shows red flash + tooltip within one frame of denial (&lt; 16ms if at 60 FPS)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Piece Deletion Edge Cases</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• User A holds piece, User B (spawner) deletes it:</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - Server force-releases lock from User A</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - User A sees piece disappear with brief notification: &quot;&lt;username&gt; deleted this piece&quot;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• User deletes piece while cursor is hovering over it:</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">  - No special handling; piece simply vanishes from scene</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Undo Stack Edge Cases</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• User undoes a piece spawn:</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - Piece is deleted from room (frees up slot for new spawns)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• User undoes piece delete:</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - Piece respawns at last known position (if room not at 50-piece cap)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - If at cap, show error: &quot;Cannot undo delete, room is full&quot;</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Undo stack persists across reconnects (stored in sessionStorage)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Browser Tab Visibility</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• User backgrounds tab (visibilitychange event):</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - Maintain WebSocket connection (don&apos;t disconnect)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">  - Reduce update frequency to 5 Hz to save bandwidth</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">  - Resume full update rate when tab becomes visible again</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Testing &amp; Validation Strategy</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Unit Tests (Backend)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Room creation and cleanup logic</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Lock acquisition/release</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Occupancy grid collision detection</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Rate limiting token bucket</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Undo stack operations</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Integration Tests</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Multi-client scenarios (simulate 2-6 concurrent users)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Simultaneous grab attempts</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Reconnection flows</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Piece limit enforcement</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Performance Testing</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Load test: 100 rooms with 6 users each (600 total connections)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Measure server CPU/memory under load</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Validate P95 latency stays &lt; 100ms</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• Client FPS benchmarking with 50 pieces and 6 users</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Manual QA Scenarios</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• &quot;Happy path&quot; collaborative building session (10+ minutes)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Network disruption (disconnect Wi-Fi, reconnect)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Browser tab switching / backgrounding</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">• Room full error flow</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">• All users leave, then rejoin empty room (should create new room)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">MVP Launch Checklist</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Pre-Launch</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ All unit and integration tests passing</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ Load testing completed (100 rooms, 600 users)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ Manual QA scenarios completed without critical issues</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ Lofi Christmas music licensed (royalty-free confirmed)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ 3D assets finalized (even if primitives, must look cohesive)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ Error messages reviewed for clarity and friendliness</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ Deployment pipeline configured (CI/CD)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">☐ Monitoring/logging set up (error tracking, latency metrics)</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Launch Day</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ Server deployed to production</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ Smoke test in production (create room, spawn pieces, invite test users)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">☐ Share link with small group (5-10 people) for initial feedback</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading2"/><w:spacing w:before="150" w:after="150"/></w:pPr><w:r><w:t xml:space="preserve">Post-Launch (First Week)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ Monitor success metrics daily (session duration, completion rate, etc.)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ Triage and fix any critical bugs within 24 hours</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">☐ Gather user feedback (informal surveys, social media mentions)</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">☐ Document lessons learned and create post-MVP roadmap</w:t></w:r></w:p><w:p><w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:before="200" w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">Open Questions &amp; Future Considerations</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">1. Should rooms have sharable links with preview images (Open Graph tags)?</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">2. Post-MVP: Add screenshot/export feature to save gingerbread house as image?</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">3. Consider optional persistence layer (save room state for 24 hours) in v2?</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">4. Add chat or emoji reactions for communication between users?</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="100"/></w:pPr><w:r><w:t xml:space="preserve">5. Implement simple physics (gravity, stacking) in post-MVP?</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/></w:pPr><w:r><w:t xml:space="preserve">6. Mobile support feasibility — what changes needed for touch controls?</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:before="300" w:after="100"/><w:jc w:val="center"/></w:pPr><w:r><w:t xml:space="preserve">—</w:t></w:r></w:p><w:p><w:pPr><w:spacing w:after="200"/><w:jc w:val="center"/></w:pPr><w:r><w:t xml:space="preserve">End of PRD v2 — Updated with comprehensive error handling, technical stack, success metrics, and implementation details.</w:t></w:r></w:p><w:sectPr><w:pgSz w:w="11906" w:h="16838" w:orient="portrait"/><w:pgMar w:top="1440" w:right="1440" w:bottom="1440" w:left="1440" w:header="708" w:footer="708" w:gutter="0"/><w:pgNumType/><w:docGrid w:linePitch="360"/></w:sectPr></w:body></w:document>